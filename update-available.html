<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cosmic Update Status</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap');

        :root {
            --bg-primary: #020010;
            --text-primary: #e0eaff;
            --text-secondary: #9098b0;
            
            --glass-bg: rgba(10, 15, 30, 0.4);
            --glass-border: rgba(0, 234, 255, 0.15);
            --glass-border-glow: rgba(0, 234, 255, 0.25);

            --glow-primary: #0077ff;   /* Deep Blue */
            --glow-secondary: #00eaff; /* Vibrant Cyan */
            --glow-tertiary: #32cd32;  /* LimeGreen (for contrast) */
            
            --success-color: #39ff8d;
            --success-glow: rgba(57, 255, 141, 0.4);
            --danger-color: #ff4757;
            --danger-glow: rgba(255, 71, 87, 0.4);

            /* For parallax effect */
            --mouse-x: 0.5;
            --mouse-y: 0.5;
        }

        html.light-mode {
            --bg-primary: #f0f2f5;
            --text-primary: #1d1d1f;
            --text-secondary: #6e6e73;
            
            --glass-bg: rgba(255, 255, 255, 0.5);
            --glass-border: rgba(0, 0, 0, 0.1);
            --glass-border-glow: rgba(0, 0, 0, 0.1);

            --glow-primary: #007aff;
            --glow-secondary: #34c759;
            --glow-tertiary: #ff9500;
            
            --success-color: #34c759;
            --success-glow: rgba(52, 199, 89, 0.4);
            --danger-color: #ff3b30;
            --danger-glow: rgba(255, 59, 48, 0.4);
        }

        *, *::before, *::after { box-sizing: border-box; }

        html, body {
            margin: 0; padding: 0;
            height: 100vh; width: 100vw;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; user-select: none;
        }

        /* --- Dynamic Backgrounds --- */
        .background-container {
            position: absolute; inset: 0;
            z-index: -1; pointer-events: none;
        }

        .stars, .stars2, .stars3 {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background-repeat: repeat;
            background-position: center;
            will-change: transform;
            transition: transform 0.1s linear;
        }
        .stars { 
            background-image: radial-gradient(1px 1px at 25px 25px, #fff, transparent); 
            background-size: 50px 50px;
            animation: star-fall 120s linear infinite;
            transform: translate(calc(var(--mouse-x) * -10px), calc(var(--mouse-y) * -10px));
        }
        .stars2 { 
            background-image: radial-gradient(1px 1px at 30px 30px, #fff, transparent); 
            background-size: 100px 100px;
            animation: star-fall 180s linear infinite;
            transform: translate(calc(var(--mouse-x) * -20px), calc(var(--mouse-y) * -20px));
        }
        .stars3 { 
            background-image: radial-gradient(1.5px 1.5px at 40px 40px, #fff, transparent); 
            background-size: 150px 150px;
            animation: star-fall 240s linear infinite;
            transform: translate(calc(var(--mouse-x) * -40px), calc(var(--mouse-y) * -40px));
        }
        @keyframes star-fall { from { background-position-y: 0px; } to { background-position-y: -1500px; } }

        .aurora {
            position: absolute; inset: -200px;
            background: 
                radial-gradient(circle at 15% 25%, var(--glow-primary), transparent 30%), 
                radial-gradient(circle at 85% 35%, var(--glow-secondary), transparent 30%), 
                radial-gradient(circle at 50% 95%, var(--glow-tertiary), transparent 30%);
            filter: blur(150px);
            opacity: 0.25;
            animation: aurora-drift 40s ease-in-out infinite alternate;
        }
        @keyframes aurora-drift {
            from { transform: rotate(0deg) scale(1); }
            to { transform: rotate(360deg) scale(1.5); }
        }


        /* --- Holographic Window --- */
        .window-container {
            width: 480px; height: 520px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(24px) saturate(150%);
            -webkit-backdrop-filter: blur(24px) saturate(150%);
            border-radius: 16px;
            box-shadow: 0 0 80px rgba(0,0,0,0.5), 0 0 20px var(--glass-border-glow) inset;
            position: relative;
            clip-path: polygon(0 20px, 20px 0, calc(100% - 20px) 0, 100% 20px, 100% calc(100% - 20px), calc(100% - 20px) 100%, 20px 100%, 0 calc(100% - 20px));
            padding: 3px;
            animation: float-in .8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
            -webkit-app-region: drag;
        }
        @keyframes float-in {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .window-content {
            background-color: transparent;
            width: 100%; height: 100%;
            border-radius: 14px;
            position: relative;
            overflow: hidden;
        }

        /* --- State Management & Transitions --- */
        .state {
            position: absolute; inset: 0;
            padding: 40px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center;
            
            /* Animation setup for entrance/exit */
            --clip-start: polygon(0 0, 100% 0, 100% 0, 0 0);
            --clip-end: polygon(0 0, 100% 0, 100% 100%, 0 100%);
            clip-path: var(--clip-start);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity .5s ease, transform .5s ease, clip-path .5s cubic-bezier(0.65, 0, 0.35, 1);
        }
        .state.active {
            clip-path: var(--clip-end);
            opacity: 1;
            transform: translateY(0);
            transition-delay: .3s; /* Delay for new state to enter */
            pointer-events: all;
        }
        .state.exiting {
            /* Defines how the old state leaves */
            --clip-start: polygon(0 100%, 100% 100%, 100% 100%, 0 100%);
            --clip-end: polygon(0 100%, 100% 100%, 100% 0, 0 0);
            clip-path: var(--clip-end);
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
            transition-delay: 0s;
        }
        
        .state .icon { width: 90px; height: 90px; margin-bottom: 25px; }
        .state .title { font-size: 28px; font-weight: 700; margin: 0 0 10px; }
        .state .message { font-size: 16px; color: var(--text-secondary); max-width: 350px; line-height: 1.7; }
        .button {
            border: none; padding: 14px 35px; border-radius: 10px; font-size: 16px;
            font-family: 'Space Grotesk', sans-serif; font-weight: 700;
            cursor: pointer; transition: all .3s ease; -webkit-app-region: no-drag;
            margin-top: 35px; letter-spacing: 0.5px;
        }

        /* --- State 1: Checking --- */
        #checking-state .title {
            animation: text-flicker 3s linear infinite;
        }
        @keyframes text-flicker { 0%,19%,22%,25%,53%,57%,100% { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px var(--glow-secondary), 0 0 30px var(--glow-secondary); } 20%,24%,55% { text-shadow: none; } }
        
        #checking-icon { animation: rotate-icon 8s linear infinite; }
        #checking-icon .ring1 { stroke-dasharray: 251; stroke-dashoffset: 251; animation: draw-ring 2s ease-in-out infinite alternate; }
        #checking-icon .ring2 { stroke-dasharray: 188; stroke-dashoffset: 188; animation: draw-ring 2s ease-in-out .2s infinite alternate; }
        #checking-icon .scanline { animation: scan 2s ease-in-out infinite; transform-origin: center; }
        @keyframes draw-ring { to { stroke-dashoffset: 0; } }
        @keyframes rotate-icon { to { transform: rotate(360deg); } }
        @keyframes scan { 0%, 100% { transform: scaleY(0); } 50% { transform: scaleY(1); } }

        /* --- State 2: Update Found --- */
        #update-found-state { justify-content: flex-start; }
        #update-found-state .title {
            background: linear-gradient(90deg, var(--glow-primary), var(--glow-secondary), var(--success-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradient-flow 3s ease infinite;
        }
        @keyframes gradient-flow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        #version { font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-top: -5px; }
        .release-notes-container {
            background-color: rgba(0,0,0,0.4); border-radius: 12px; padding: 10px 20px;
            flex-grow: 1; overflow-y: auto; border: 1px solid var(--glass-border);
            margin: 20px 0; width: 100%; -webkit-app-region: no-drag;
        }
        .release-notes-container::-webkit-scrollbar { width: 6px; }
        .release-notes-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        #release-notes ul { padding-left: 20px; margin: 10px 0; list-style-type: 'ðŸš€ '; }
        #release-notes li { margin-bottom: 12px; font-size: 15px; line-height: 1.6; }
        #release-notes a { color: var(--glow-secondary); text-decoration: none; font-weight: 700; }
        #release-notes h3 { margin-bottom: 8px; font-size: 16px; border-bottom: 1px solid var(--glass-border); padding-bottom: 8px; }
        .button-group { display: flex; gap: 15px; -webkit-app-region: no-drag; width: 100%; margin-top: auto; }
        .button-group .button { flex-grow: 1; margin-top: 0; }
        #later-btn { background-color: transparent; color: var(--text-secondary); border: 1px solid var(--glass-border); }
        #later-btn:hover { background-color: var(--glass-border); color: var(--text-primary); }
        #download-btn {
            background: linear-gradient(90deg, var(--glow-primary), var(--glow-secondary)); color: #fff;
            box-shadow: 0 0 25px rgba(0, 120, 255, 0.4); animation: pulse-glow 2.5s infinite;
        }
        #download-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 40px rgba(0, 234, 255, 0.5);
        }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 25px rgba(0, 120, 255, 0.4); } 50% { box-shadow: 0 0 35px rgba(0, 234, 255, 0.5); } 100% { box-shadow: 0 0 25px rgba(0, 120, 255, 0.4); } }

        /* --- State 3 & 4: No Update & Error --- */
        .icon-final { stroke-dasharray: 200; stroke-dashoffset: 200; animation: draw-final-icon 1s .5s forwards; }
        @keyframes draw-final-icon { to { stroke-dashoffset: 0; } }
        
        #no-update-state .title { color: var(--success-color); }
        #close-btn { background-color: var(--success-color); color: var(--bg-primary); }
        #close-btn:hover { transform: scale(1.05); box-shadow: 0 4px 25px var(--success-glow); }

        #error-state .title { color: var(--danger-color); animation: glitch-error .4s .4s both; }
        @keyframes glitch-error {
            0% { transform: translate(0); } 20% { transform: translate(-3px, 3px); }
            40% { transform: translate(3px, -3px); } 60% { transform: translate(-3px, -3px); }
            80% { transform: translate(3px, 3px); } 100% { transform: translate(0); }
        }
        #error-close-btn { background-color: var(--danger-color); color: var(--bg-primary); }
        #error-close-btn:hover { transform: scale(1.05); box-shadow: 0 4px 25px var(--danger-glow); }

    </style>
</head>
<body>
    <div class="background-container">
        <div class="aurora"></div>
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
    </div>
    
    <div class="window-container">
        <div class="window-content">
            
            <div id="checking-state" class="state active">
                <svg id="checking-icon" class="icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle class="ring1" cx="50" cy="50" r="40" stroke="url(#gradient-check)" stroke-width="4"/>
                    <circle class="ring2" cx="50" cy="50" r="30" stroke="url(#gradient-check)" stroke-width="2" stroke-opacity="0.5"/>
                    <line class="scanline" x1="50" y1="10" x2="50" y2="90" stroke="url(#gradient-check)" stroke-width="2"/>
                    <defs>
                        <linearGradient id="gradient-check" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="var(--glow-secondary)"/>
                            <stop offset="100%" stop-color="var(--glow-primary)"/>
                        </linearGradient>
                    </defs>
                </svg>
                <h1 class="title">Querying the Cosmic Archives...</h1>
                <p class="message">Asking the server nicely if it has any fresh bits for us. Hold tight, the server hamsters are just waking up.</p>
            </div>

            <div id="update-found-state" class="state">
                <h1 class="title">Great Scott! An Update Has Landed!</h1>
                <p id="version">Loading version info...</p>
                <div class="release-notes-container">
                    <div id="release-notes"></div>
                </div>
                <div class="button-group">
                    <button id="later-btn" class="button">I'll Live Dangerously</button>
                    <button id="download-btn" class="button">Engage!</button>
                </div>
            </div>
            
            <div id="no-update-state" class="state">
                <svg class="icon icon-final" viewBox="0 0 52 52">
                    <circle style="stroke: var(--success-color);" cx="26" cy="26" r="25" fill="none" stroke-width="4"/>
                    <path style="stroke: var(--success-color);" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" stroke-width="6" stroke-linecap="round"/>
                </svg>
                <h1 class="title">Nailed It! You're on the Bleeding Edge.</h1>
                <p class="message">Your version is the freshest of the fresh. No updates needed. Keep being awesome.</p>
                <button id="close-btn" class="button">Rock On!</button>
            </div>

            <div id="error-state" class="state">
                <svg class="icon icon-final" viewBox="0 0 52 52">
                    <circle style="stroke: var(--danger-color);" cx="26" cy="26" r="25" fill="none" stroke-width="4"/>
                    <path style="stroke: var(--danger-color);" fill="none" d="M16 16 36 36 M36 16 16 36" stroke-width="6" stroke-linecap="round"/>
                </svg>
                <h1 class="title">Houston, We Have a Poodle.</h1>
                <p id="error-message" class="message">There seems to be a glitch in the Matrix. Check your connection or try again after the robots have had their coffee.</p>
                <button id="error-close-btn" class="button">Abort Mission</button>
            </div>
        </div>
    </div>

<script>
    const states = {
        checking: document.getElementById('checking-state'),
        found: document.getElementById('update-found-state'),
        notFound: document.getElementById('no-update-state'),
        error: document.getElementById('error-state'),
    };
    let currentStateKey = 'checking';

    function showState(newStateKey) {
        if (newStateKey === currentStateKey || !states[newStateKey]) return;

        const oldState = states[currentStateKey];
        const newState = states[newStateKey];
        
        if (oldState) {
            oldState.classList.add('exiting');
            
            // Wait for the exit animation to finish before hiding it completely
            setTimeout(() => {
                oldState.classList.remove('active', 'exiting');
            }, 500); // This duration should match the transition duration in CSS
        }
        
        newState.classList.add('active');
        currentStateKey = newStateKey;
    }

    document.addEventListener('DOMContentLoaded', () => {
        // --- API Mock for testing in browser ---
        // You can comment this out when using in Electron.
        const mockAPI = {
            onUpdateInfo: (callback) => {
                // Simulate a check
                setTimeout(() => callback({ status: 'checking' }), 500);
                
                // Simulate one of the results after a delay
                const results = [
                    { 
                        status: 'update-available', 
                        version: 'v2.0-SUPERNOVA', 
                        releaseNotesHTML: "<h3>What's new in this galaxy?</h3><ul><li>A revolutionary feature that launches your productivity into the stratosphere.</li><li>Squashed some intergalactic bugs that were messing with the timeline.</li><li>The UI now feels like it was taken from a spaceship. <a href='#'>Read more</a>.</li><li>Added a mysterious new button. We're not sure what it does. Good luck.</li></ul>" 
                    },
                    { status: 'up-to-date' },
                    { status: 'error', message: "connection timed out" }
                ];
                const randomResult = results[Math.floor(Math.random() * results.length)];

                setTimeout(() => callback(randomResult), 4000);
            },
            openDownloadPage: () => alert("Redirecting to download page... Vrooom!"),
            closeUpdateWindow: () => alert("Closing update window. See you, space cowboy...")
        };
        const api = window.updateAPI ? window.updateAPI : mockAPI;
        const mainAppApi = window.electronAPI ? window.electronAPI : mockAPI;
        // --- End of Mock ---

        api.onUpdateInfo((data) => {
            switch(data.status) {
                case 'checking':
                    showState('checking');
                    break;
                case 'update-available':
                    document.getElementById('version').textContent = `Version ${data.version} is ready for deployment!`;
                    document.getElementById('release-notes').innerHTML = data.releaseNotesHTML;
                    showState('found');
                    break;
                case 'up-to-date':
                    showState('notFound');
                    break;
                case 'error':
                    if (data.message) {
                        document.getElementById('error-message').textContent = `The server mumbled something about: "${data.message}". Please try again later.`;
                    }
                    showState('error');
                    break;
            }
        });

        document.getElementById('download-btn').addEventListener('click', () => mainAppApi.openDownloadPage());
        document.getElementById('later-btn').addEventListener('click', () => mainAppApi.closeUpdateWindow());
        document.getElementById('close-btn').addEventListener('click', () => mainAppApi.closeUpdateWindow());
        document.getElementById('error-close-btn').addEventListener('click', () => mainAppApi.closeUpdateWindow());

        // Parallax background effect
        document.body.addEventListener('mousemove', (e) => {
            const { clientX, clientY } = e;
            const { innerWidth, innerHeight } = window;
            const x = (clientX / innerWidth) - 0.5;
            const y = (clientY / innerHeight) - 0.5;
            document.documentElement.style.setProperty('--mouse-x', x);
            document.documentElement.style.setProperty('--mouse-y', y);
        });
    });
</script>
<script>
// --- Theme Application Logic ---
function applyTheme(theme) {
    if (theme === 'light') {
        document.documentElement.classList.add('light-mode');
    } else {
        document.documentElement.classList.remove('light-mode');
    }
}

if (window.electronAPI) {
    window.electronAPI.theme.getResolved().then(applyTheme);
    window.electronAPI.theme.onUpdate(applyTheme);
}
</script>
</body>
</html>
